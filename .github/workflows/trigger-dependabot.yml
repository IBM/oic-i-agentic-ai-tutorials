name: View Dependabot Configuration

on:
  workflow_dispatch:
    inputs:
      package-ecosystem:
        description: 'Package ecosystem to check (or "all")'
        required: false
        default: 'all'
        type: choice
        options:
          - all
          - pip
          - npm
          - docker

permissions:
  contents: read
  security-events: read

jobs:
  trigger-dependabot:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Display Dependabot Information
        env:
          ECOSYSTEM: ${{ inputs.package-ecosystem }}
          REPO: ${{ github.repository }}
        run: |
          echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
          echo "ğŸ“¦ Dependabot Manual Trigger Guide"
          echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
          echo ""
          echo "Selected ecosystem: $ECOSYSTEM"
          echo ""
          echo "âš ï¸  NOTE: GitHub doesn't provide a direct API to trigger"
          echo "    Dependabot on-demand via workflows."
          echo ""
          echo "âœ… To manually trigger Dependabot updates:"
          echo ""
          echo "   Method 1 (Web UI - Easiest):"
          echo "   1. Go to: https://github.com/$REPO/network/updates"
          echo "   2. OR: Insights > Dependency graph > Dependabot"
          echo "   3. Click 'Check for updates' button"
          echo ""
          echo "   Method 2 (Security Alerts):"
          echo "   1. Go to: https://github.com/$REPO/security/dependabot"
          echo "   2. View current vulnerabilities"
          echo "   3. Dependabot will auto-create PRs for these"
          echo ""
          echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"

      - name: Show Configuration Summary
        run: |
          echo ""
          echo "ğŸ“‹ Current Dependabot Configuration:"
          echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
          echo ""

          if [ -f .github/dependabot.yml ]; then
            echo "âœ… Configuration file exists"
            echo ""
            echo "Monitored ecosystems:"
            grep -A 2 "package-ecosystem:" .github/dependabot.yml | grep -v "^--$" || true
            echo ""
            echo "Schedule:"
            grep "interval:" .github/dependabot.yml | sort -u || true
            echo ""
            echo "Full configuration:"
            cat .github/dependabot.yml
          else
            echo "âŒ No dependabot.yml found!"
          fi

      - name: Next Steps
        run: |
          echo ""
          echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
          echo "ğŸ“ Next Steps:"
          echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
          echo ""
          echo "1. Visit: https://github.com/${{ github.repository }}/network/updates"
          echo "2. Click 'Check for updates' for each ecosystem"
          echo "3. Wait for Dependabot to create PRs"
          echo "4. Security patches will auto-merge (if configured)"
          echo ""
          echo "For more details, see: .github/DEPENDABOT_SETUP.md"
          echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
